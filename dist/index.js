(()=>{var e,r={764:(e,r,t)=>{var n=t(860),s=n();t(17);s.use(n.urlencoded({extended:!1})),s.use(n.json()),s.use(t(953)),s.set("port",process.env.PORT),e.exports=s},187:(e,r,t)=>{"use strict";t.r(r);var n=t(591),s=t.n(n),o=t(307),a=t.n(o),u=t(344),i=t(714);exports.login=function(){var e=s()(a().mark((function e(r,t){var n,s,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body.dni,e.next=3,i.findOne({dni:n},(function(e){return e}));case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",t.json({done:!1,message:"Usuario no encontrado"}).status(404));case 6:return o=u.sign(s._id.toString(),process.env.SECRET),e.abrupt("return",t.json({token:o,message:"Inicio sesíon exitoso!"}).status(200));case 8:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),exports.register=function(){var e=s()(a().mark((function e(r,t){var n,s,o,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,s=n.dni,o=n.name,e.next=3,i.findOne({dni:s});case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",t.json({message:"El usuario ya está registrado"}).status(400));case 6:if(s&&o){e.next=8;break}return e.abrupt("return",t.json({message:"Complete el formulario",done:!1}).status(400));case 8:return u=new i({dni:s,name:o}),e.next=11,u.save();case 11:return e.abrupt("return",t.json({message:"Usuario registrado correctamente!"}).status(200));case 12:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()},362:(e,r,t)=>{"use strict";t.r(r);var n=t(591),s=t.n(n),o=t(307),a=t.n(o),u=t(127);exports.submitPills=function(){var e=s()(a().mark((function e(r,t){var n,s,o,i,c,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,s=n.pillName,o=n.repeat,i=n.pillHour,c=n.amount,s&&o&&i&&c){e.next=3;break}return e.abrupt("return",t.json({message:"Faltan datos",done:!1}).status(403));case 3:return p=new u({pillName:s,repeat:o,pillHour:i,amount:c,idUser:r.userId}),e.next=6,p.save();case 6:return e.abrupt("return",t.json({message:"Pastilla cargada con éxito"}).status(200));case 7:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),exports.getPills=function(){var e=s()(a().mark((function e(r,t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.find({idUser:r.userId});case 3:return n=e.sent,e.abrupt("return",t.json({pills:n}));case 7:throw e.prev=7,e.t0=e.catch(0),new Error("Error obteniendo las pastillas ".concat(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,t){return e.apply(this,arguments)}}(),exports.getOnePill=function(){var e=s()(a().mark((function e(r,t){var n,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.params.id){e.next=3;break}return e.abrupt("return",t.json({message:"id pill empty"}).status(400));case 3:return e.prev=3,e.next=6,u.findOne({_id:n});case 6:if(s=e.sent){e.next=9;break}return e.abrupt("return",t.json({message:"Pastilla no encontrada"}).status(404));case 9:return e.abrupt("return",t.json({done:!0,results:s}));case 12:throw e.prev=12,e.t0=e.catch(3),new Error("Error finding id / ".concat(e.t0));case 15:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(r,t){return e.apply(this,arguments)}}()},629:(e,r,t)=>{"use strict";t.r(r);var n=t(591),s=t.n(n),o=t(307),a=t.n(o),u=t(693);exports.submitRecord=function(){var e=s()(a().mark((function e(r,t){var n,s,o,i,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,s=n.pillName,o=n.pillDate,i=n.amount,s&&o&&i){e.next=3;break}return e.abrupt("return",t.json({message:"Faltan datos"}).status(400));case 3:return e.prev=3,(c=new u({pillName:s,pillDate:o,idUser:r.userId,amount:i})).pillDate=c.formatDate(c.pillDate),e.next=8,c.save();case 8:return e.abrupt("return",t.json({done:!0}).status(200));case 11:throw e.prev=11,e.t0=e.catch(3),console.log(e.t0),new Error("Error al guardar el registro");case 15:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(r,t){return e.apply(this,arguments)}}(),exports.getRecords=function(){var e=s()(a().mark((function e(r,t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.find({idUser:r.userId},(function(e){return e}));case 2:return n=e.sent,e.abrupt("return",t.json({records:n}).status(200));case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),exports.getOneRecord=function(){var e=s()(a().mark((function e(r,t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(r.params.id),e.next=3,u.findById(r.params.id);case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",t.json({done:!1,message:"Registro no encontrado"}).status(404));case 6:t.json({done:!0,record:n}).status(200);case 7:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()},929:(e,r,t)=>{var n=t(185);n.connect(process.env.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0}),n.connection.on("open",(function(){console.log("Database connected!")})),n.connection.on("error",(function(e){console.log(e)})),e.exports=n},127:(e,r,t)=>{var n=t(185),s=n.Schema,o=n.model,a=new s({pillName:{type:String,required:!0},repeat:{type:Number,required:!0},pillHour:{type:String,required:!0},idUser:{type:String,required:!0},amount:{type:Number,required:!0}});e.exports=o("Pills",a)},693:(e,r,t)=>{var n=t(185),s=n.Schema,o=n.model,a=new s({pillName:{type:String,required:!0},pillDate:{type:Date,required:!0},idUser:{type:String,required:!0},amount:{type:Number,required:!0,default:1}});a.methods.formatDate=function(e){return new Date(e)},e.exports=o("Records",a)},714:(e,r,t)=>{var n=t(185),s=n.Schema,o=n.model,a=new s({dni:{type:String,required:!0},name:{type:String,required:!0}});e.exports=o("Users",a)},953:(e,r,t)=>{t(929);var n=t(860).Router(),s=t(629),o=s.submitRecord,a=s.getRecords,u=s.getOneRecord,i=t(187),c=i.register,p=i.login,l=t(362),d=l.getPills,f=l.submitPills,g=l.getOnePill,m=t(992),v=m.userAlreadyLogged,x=m.userMustBeLogged;n.get("/records",x),n.get("/records",a),n.post("/new-record",x),n.post("/new-record",o),n.get("/record/:id",x),n.get("/record/:id",u),n.get("/pills",x),n.get("/pills",d),n.post("/new-pill",x),n.post("/new-pill",f),n.get("/pill/:id",x),n.get("/pill/:id",g),n.post("/register",v),n.post("/register",c),n.post("/login",v),n.post("/login",p),e.exports=n},992:(e,r,t)=>{var n=t(344);e.exports={userMustBeLogged:function(e,r,t){var s=e.headers["x-access-token"];if(!s)return r.json({message:"the user must be logged"}).status(401);e.userId=n.verify(s,process.env.SECRET),t()},userAlreadyLogged:function(e,r,t){if(e.headers["x-access-token"])return r.json({message:"user already logged"}).status(401);t()}}},591:e=>{"use strict";e.exports=require("@babel/runtime/helpers/asyncToGenerator")},307:e=>{"use strict";e.exports=require("@babel/runtime/regenerator")},860:e=>{"use strict";e.exports=require("express")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},185:e=>{"use strict";e.exports=require("mongoose")},17:e=>{"use strict";e.exports=require("path")}},t={};function n(e){var s=t[e];if(void 0!==s)return s.exports;var o=t[e]={exports:{}};return r[e](o,o.exports,n),o.exports}n.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return n.d(r,{a:r}),r},n.d=(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(e=n(764)).listen(e.get("port"),(function(){console.log("Server Up!")}))})();